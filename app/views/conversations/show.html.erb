<div class="h-full flex bg-background" data-controller="chat">
  <!-- 主要内容区域 -->
  <div class="flex-1 flex flex-col">
    <!-- 对话展示区域 - 只有这里可以滚动 -->
    <div class="flex-1 overflow-y-auto" id="message-container" data-chat-target="container">
      <div class="p-6 space-y-6" id="conversation_messages">
        <%= turbo_stream_from "conversation_#{@conversation.id}" %>
        <% @messages.each do |message| %>
          <%= render partial: "messages/#{message.role}_message", locals: { message: message } %>
        <% end %>
      </div>
    </div>

    <!-- 固定底部编辑工具栏 -->
    <div class="flex-shrink-0 border-t border-border bg-background p-4">
      <%= form_with model: [@conversation, Message.new], 
                    data: { controller: "reset-form", action: "turbo:submit-end->reset-form#reset" },
                    class: "flex items-center space-x-4" do |f| %>
        <div class="flex-1">
          <div class="relative">
            <%= f.text_area :content, 
                           rows: 1, 
                           class: "w-full bg-muted rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-ring", 
                           placeholder: "输入消息...",
                           data: { chat_target: "input", action: "keydown->chat#checkSubmit" } %>
            <button type="submit" class="absolute right-2 top-1/2 transform -translate-y-1/2 p-2 hover:bg-muted rounded">
              <%= lucide_icon "send", class: "w-5 h-5" %>
            </button>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- 右侧边栏 -->
  <div class="w-64 bg-muted/50 border-l border-border flex flex-col flex-shrink-0">
    <div class="p-4 border-b border-border">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold text-lg"><%= @assistant.name %></h2>
        <button class="p-2 hover:bg-muted rounded-full" data-controller="theme-switcher">
          <%= lucide_icon "sun", class: "w-5 h-5 dark:hidden" %>
          <%= lucide_icon "moon", class: "w-5 h-5 hidden dark:block" %>
        </button>
      </div>
    </div>
    <div class="flex-1 p-4 space-y-4 overflow-y-auto">
      <h3 class="font-semibold text-md">对话历史</h3>
      <% @assistant.conversations.order(created_at: :desc).each do |conv| %>
        <div class="p-2 hover:bg-muted rounded cursor-pointer">
          <%= link_to conv.title, assistant_conversation_path(@assistant, conv), class: "block" %>
        </div>
      <% end %>
    </div>
  </div>
</div> 